---
title: "Projet de Séries Temporelles: modélisation ARMA"
author: "Conrad Thiounn et Léo Houairi"
date: "14/04/2022"
output:
  pdf_document:
    toc: yes
    toc_depth: '2'
  bookdown::pdf_document2:
    toc: yes
    toc_depth: 2
    toc_title: Table des matières
sansfont: Times New Roman
fontsize: 12pt
header-includes: \renewcommand*\contentsname{Table des matières}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages('tinytex')
#tinytex::install_tinytex()
```

```{r chargement, include=FALSE}
require(zoo)
require(tseries)
require(fUnitRoots)
require(forecast)

## Importation des données 

datafile <- "data/valeurs_mensuelles.csv"
data <- read.csv(datafile, sep=";", skip = 3, col.names =c("mois", "valeur", "A"))
data <- data[,-3] # Suppression de la colonne inutile

dates_char <- data$mois
dates_char[1]; dates_char[length(dates_char)] # Janvier 1990 à Février 2022
dates <- as.yearmon(seq(from = 1990+0/12, to = 2022+1/12, by = 1/12))


## Premiers graphiques

indice <- zoo(data$valeur, order.by = dates) # C'est bien la liste précédente qui est utile
dindice <- diff(indice, 1) # Différence première
```

# Partie 1 : Les données

## 1 - Série choisie

``` Que représente la série choisie ? (secteur, périmètre, traitements éventuels, transformation logarithmique, etc.)```

La série choisie représente l'indice de la production industrielle de la fabrication de machines agricoles et forestières, élaborée à partir des enquêtes de branche de l'Insee. Elle est exprimée en base 100, avec pour année de référence 2015 et a fait l'objet de deux corrections des variations saisonnières et des effets de calendrier (CVS-CJO) à l'aide de la méthode X13-Arima. Les corrections CVS-CJO ont été calculées sur deux sous-périodes dénommées "le Passé" et "le Courant" délimitées par l'année 2005. "Le Courant" est composé des observations de l'année 2005 et posterieures tandis que "le Passé" est composées des observations antérieurs à 2005. Les observations sont mensuelles et sont comprises entre janvier 1990 et février 2022.


La fabrication de machines agricoles et forestières est repertoriée dans la nomenclature d'activité française (NAF rév. 2) sous le poste 28.3. La nomenclature NAF Rév. 2 date de janvier 2008 : il est possible d'observer des ruptures de tendances liées à ce changement, dues à des éventuels changements entre la NAF Rév. 1 et la NAF Rev. 2, de reclassement de produits ou de classes.

La fabrication comprend notamment la fabrication de charrues, de tracteurs et de machines à traire. L'analyse temporelle de l'indice de la production industrielle permet de rendre compte de l'évolution de la valeur ajoutée du secteur concerné.



## 2 - Transformation

``` Transformer si besoin la série pour la rendre stationnaire (différentiation, suppression de la tendance déterministe, etc.). Justifier soigneusement vos choix.```

La série choisie ne semble pas être stationnaire. Le chronogramme ressemble à une marche aléatoire.
```{R image chronogramme, echo=FALSE, fig.cap="Chronogramme de la série brute", out.width = '100%'}
#knitr::include_graphics("chronogramme_serie_brut.png")
plot(indice, main="Série brute")

```

### 2.1 Non-stationnarité de la série initiale

Afin de statuer sur la stationnarité de la série initiale, nous testons dans un premier temps si la série présente une tendance linéaire déterministe en régressant la série par le temps. La regression linéaire donne des coefficients non significatifs aux seuils usuels. Il n'est pas possible d'en déduire l'existence d'une tendance linéaire déterministe.

Nous testons alors la présence d'une composante stochastique à l'aide des tests de Dickey-Fuller augmentés et de Phillips-Perron.

Le premier test de Dickey-Fuller valide avec des résidus non corrélés incorpore 5 retards et nous propose de ne pas rejetter l'hypothèse nulle de non-stationnarité.

```
Title:
 Augmented Dickey-Fuller Test

Test Results:
  PARAMETER:
    Lag Order: 5
  STATISTIC:
    Dickey-Fuller: -0.73
  P VALUE:
    0.3837 
```

### 2.1 Stationnarité de la série différenciée

Nous effectuons la même méthodologie que sur la série brute en testant en premier lieu la présence d'une tendance linéaire déterministe. La régression linéaire donne également des coefficients non significatifs aux seuils usuels, présageant l'inexistexe d'une tendance linéaire déterministe de la série différenciée.

Le premier test de Dickey-Fuller valide avec des résidus non corrélés incorpore 4 retards et nous propose de rejetter l'hypothèse nulle de non-stationnarité (p-value=0.01).

```
Title:
 Augmented Dickey-Fuller Test

Test Results:
  PARAMETER:
    Lag Order: 4
  STATISTIC:
    Dickey-Fuller: -12.356
  P VALUE:
    0.01 
```

Le test de Phillips-Perron donne la même conclusion, avec 5 retards en proposant de rejetter l'hypothèse nulle de non-stationnarité (p-value=0.01).

```
	Phillips-Perron Unit Root Test

data:  dindice
Dickey-Fuller Z(alpha) = -401.19, Truncation lag parameter = 5, p-value = 0.01
alternative hypothesis: stationary
```


Le test de stationnarité KPSS nous propose de ne pas rejetter l'hypothèse nulle de stationnarité (p-value=0.1) au seuil de 5%.

```
	KPSS Test for Level Stationarity

data:  dindice
KPSS Level = 0.027926, Truncation lag parameter = 5, p-value = 0.1
```


## 3 - Graphiques

``` Représenter graphiquement la série choisie avant et après transformation. ```

```{R chronogramme, echo=FALSE, fig.cap="Chronogramme de la série brute et de la série différenciée", out.width = '100%'}

plot(cbind(indice, dindice), main="Série brute et série transformée")
```

# Partie 2 : Modèles ARMA

## 4 - Choix de l'ARMA

``` 4. Choisir, en le justifiant, un modèle ARMA(p,q) pour votre série corrigée Xt. Estimer les paramètres du modèle et vérifier sa validité. ```

```{R ACF PACF, echo=FALSE, fig.cap="Autocorrélogramme et autoccorélogramme partiel", out.width = '100%'}
x = dindice # Le x sur lequel on travaille est la série différenciée

par(mfrow=c(1,2))
acf(x,main="Autocorrélogramme"); pacf(x,main="Autocorrélogramme partiel")
```

L'analyse de l'autocorrélogramme empirique, conjointement avec l'autocorrélogramme partiel empirique ne nous permet pas de nous diriger d'emblée vers une modélisation par un modèle AR ou à un modèle MA. Nous testons alors les modèles ARMA(p,q) avec pmax = 5, qmax = 2 et les critères AIC et BIC poru la sélection du modèle.

Avec le critère AIC, nous retenons un modèle ARMA(5,0) pour la série différenciée et donc un modèle ARIMA(5,1,0) pour la série initiale. Le modèle est bien ajusté car les coefficients sont significatifs aux seuils usuels. Le modèle est également valide car les résidus ne sont pas autocorrelés.

```
Call:
arima(x = indice, order = c(5, 1, 0), include.mean = F)

Coefficients:
          ar1      ar2      ar3      ar4      ar5
      -0.3166  -0.2305  -0.1163  -0.1750  -0.1449
s.e.   0.0506   0.0531   0.0551   0.0545   0.0535

sigma^2 estimated as 124.2:  log likelihood = -1474.59,  aic = 2961.19
```

Avec le critère BIC, nous retenons un modèle ARMA(1,1) pour la série différenciée et donc un modèle ARIMA(1,1,1) pour la série initiale. Le modèle est bien ajusté car les coefficients sont significatifs aux seuils usuels. Le modèle est également valide car les résidus ne sont pas autocorrelés.

```
arima(x = indice, order = c(1, 1, 1), include.mean = F)

Coefficients:
         ar1      ma1
      0.4006  -0.7190
s.e.  0.1029   0.0778

sigma^2 estimated as 126.1:  log likelihood = -1477.6,  aic = 2961.19
```

## 5 - Ecriture de l'ARIMA

``` 5. Exprimer le modèle ARIMA(p,d,q) pour la série choisie. ```

Pour le modèle ARIMA(5,1,0) :
$\left( 1 - \sum_{i=1}^5 \varphi_i L^i \right)
(1-L) X_t
= \varepsilon_t \,$
avec $\hat\varphi=(\hat\varphi_i)_i=(-0.3166,  -0.2305,  -0.1163,  -0.1750,  -0.1449)$

Pour le modèle ARIMA(1,1,1):
$\left( 1 -  \varphi L \right)
(1-L) X_t
= \left( 1 +\theta L \right) \varepsilon_t \,$
avec $\hat\varphi = 0.4006$ et $\hat\theta =  -0.7190$

# Partie 3 : Prévision

## 6 - Equation RC

``` 6. Ecrire l’équation vérifiée par la région de confiance de niveau alpha sur les valeurs futures (XT +1, XT +2). ```

Pour le modèle ARIMA(1,1,1):


## 7 - Hypothèses

``` 7. Préciser les hypothèses utilisées pour obtenir cette région. ```

On suppose que les $\varepsilon_t$ sont gaussiens iid.

## 8 - Graphique région

``` 8. Représenter graphiquement cette région pour alpha = 95%. Commenter. ```


## 9 - Question ouverte

``` 9. Question ouverte : soit Yt une série stationnaire disponible de t = 1 à T. On suppose que YT +1 est disponible plus rapidement que XT +1. Sous quelle(s) condition(s) cette information permet-elle d’améliorer la prévision de XT +1 ? Comment la (les) testeriez-vous ? ```

# Annexe: code utilisé